# R√®gles Cursor pour Sentiers 974

## ‚ö†Ô∏è R√àGLES CRITIQUES - √Ä RESPECTER ABSOLUMENT

### üö® NE JAMAIS CASSER UN COMPOSANT QUI FONCTIONNE

**R√àGLE D'OR**: Avant de modifier ou corriger un composant, TOUJOURS :

1. **Lire et comprendre** le code existant en entier
2. **Identifier** exactement ce qui fonctionne d√©j√†
3. **Isoler** le probl√®me sp√©cifique √† corriger
4. **Tester** que la modification ne casse pas les fonctionnalit√©s existantes

#### ‚ùå CE QU'IL NE FAUT JAMAIS FAIRE :

- R√©√©crire un composant entier pour corriger un petit bug
- Supprimer du code "qui semble inutile" sans comprendre son r√¥le
- Modifier la logique qui fonctionne pour en corriger une autre
- Changer les props ou l'interface d'un composant utilis√© ailleurs sans v√©rifier l'impact
- Refactoriser "pour am√©liorer" un composant qui fonctionne parfaitement

#### ‚úÖ CE QU'IL FAUT FAIRE :

- **Correction chirurgicale** : Modifier UNIQUEMENT la partie probl√©matique
- **Ajout non-intrusif** : Ajouter des fonctionnalit√©s sans toucher au code existant
- **Tests de r√©gression** : V√©rifier que tout ce qui marchait marche toujours
- **Isolation** : Si besoin de gros changements, cr√©er un nouveau composant plut√¥t que casser l'ancien
- **Documentation** : Expliquer POURQUOI on touche √† un composant qui fonctionne

#### Principe : "Si √ßa marche, ne le touche pas"

```typescript
// ‚ùå MAUVAIS - R√©√©crire tout le composant pour corriger un bug mineur
const TrackingStats = () => {
  // Tout r√©√©crire avec une nouvelle logique
  // Risque : casser ce qui marchait
};

// ‚úÖ BON - Correction cibl√©e
const TrackingStats = () => {
  // ... code existant qui fonctionne ...

  // FIX: Correction du bug sp√©cifique ligne X
  const fixedValue = value ?? 0; // Ajout null check

  // ... reste du code inchang√© ...
};
```

#### En cas de doute :
1. **Demander** avant de faire un changement majeur
2. **Cr√©er un nouveau composant** plut√¥t que modifier l'ancien
3. **Faire des commits atomiques** : 1 probl√®me = 1 commit
4. **Tester syst√©matiquement** apr√®s chaque modification

---

## Stack Technique

- **Framework**: React Native 0.81.4 avec Expo ~54.0.0
- **Langage**: TypeScript 5.8.3 (strict mode activ√©)
- **Styling**: NativeWind 4.x (Tailwind CSS pour React Native)
- **Navigation**: React Navigation 7.x (Native Stack & Stack Navigator)
- **State Management**: Zustand 5.x
- **Storage**: AsyncStorage + SecureStore (Expo)
- **G√©olocalisation**: expo-location avec tracking en arri√®re-plan
- **Cartes**: react-native-maps
- **Requ√™tes HTTP**: Axios

## Structure du Projet

```
src/
‚îú‚îÄ‚îÄ App.tsx                 # Point d'entr√©e principal
‚îú‚îÄ‚îÄ components/             # Composants r√©utilisables
‚îÇ   ‚îú‚îÄ‚îÄ events/            # Composants li√©s aux √©v√©nements
‚îÇ   ‚îú‚îÄ‚îÄ map/               # Composants de carte
‚îÇ   ‚îú‚îÄ‚îÄ modals/            # Modales g√©n√©riques
‚îÇ   ‚îú‚îÄ‚îÄ sentiers/          # Composants des sentiers
‚îÇ   ‚îú‚îÄ‚îÄ social/            # Composants sociaux (posts, feed)
‚îÇ   ‚îú‚îÄ‚îÄ tracking/          # Composants de suivi GPS
‚îÇ   ‚îî‚îÄ‚îÄ ui/                # Composants UI g√©n√©riques
‚îú‚îÄ‚îÄ data/                  # Donn√©es statiques et configurations
‚îú‚îÄ‚îÄ hooks/                 # Custom hooks React
‚îú‚îÄ‚îÄ screens/               # √âcrans de l'application
‚îú‚îÄ‚îÄ services/              # Services API et logique m√©tier
‚îú‚îÄ‚îÄ store/                 # Stores Zustand
‚îú‚îÄ‚îÄ types/                 # D√©finitions TypeScript
‚îî‚îÄ‚îÄ utils/                 # Fonctions utilitaires
```

## Conventions de Code

### TypeScript

- **TOUJOURS** utiliser TypeScript strict mode
- **TOUJOURS** typer explicitement les props des composants
- **TOUJOURS** typer les retours de fonctions pour les fonctions complexes
- Utiliser des interfaces pour les props de composants
- Utiliser des types pour les unions et les helpers
- √âviter `any` - utiliser `unknown` si n√©cessaire

```typescript
// ‚úÖ BON
interface UserCardProps {
  user: User;
  onPress: (userId: string) => void;
  variant?: 'compact' | 'detailed';
}

export const UserCard: React.FC<UserCardProps> = ({ user, onPress, variant = 'compact' }) => {
  // ...
};

// ‚ùå MAUVAIS
export const UserCard = ({ user, onPress }) => {
  // ...
};
```

### Composants React Native

- **TOUJOURS** utiliser des composants fonctionnels avec hooks
- Pr√©f√©rer `React.FC<Props>` pour les composants
- Organiser les imports dans cet ordre:
  1. React et React Native
  2. Biblioth√®ques tierces
  3. Composants locaux
  4. Hooks personnalis√©s
  5. Types
  6. Utils et constantes

```typescript
// ‚úÖ Ordre des imports
import React, { useState, useEffect } from 'react';
import { View, Text, TouchableOpacity } from 'react-native';
import { useNavigation } from '@react-navigation/native';
import axios from 'axios';

import { Button } from '@/components/ui';
import { useGeolocation } from '@/hooks';
import type { Trail } from '@/types';
import { formatDistance } from '@/utils';
```

### Styling avec NativeWind

- **TOUJOURS** utiliser NativeWind pour le styling (classes Tailwind)
- Pr√©f√©rer les classes utilitaires plut√¥t que StyleSheet
- Utiliser `className` au lieu de `style` quand possible
- Pour les styles dynamiques complexes, utiliser les class conditionnelles

```typescript
// ‚úÖ BON
<View className="flex-1 bg-white p-4">
  <Text className={`text-lg font-bold ${isActive ? 'text-green-600' : 'text-gray-600'}`}>
    Titre
  </Text>
</View>

// ‚ùå √âviter StyleSheet sauf cas sp√©cifiques
const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: 'white' }
});
```

### Navigation

- Utiliser React Navigation avec TypeScript strict typing
- D√©finir les types de navigation dans `src/types/navigation.ts`
- Toujours typer les param√®tres de route

```typescript
// types/navigation.ts
export type RootStackParamList = {
  Home: undefined;
  TrailDetail: { trailId: string };
  Tracking: { sessionId?: string };
};

// Dans un composant
import type { NativeStackNavigationProp } from '@react-navigation/native-stack';
import type { RootStackParamList } from '@/types/navigation';

type Props = {
  navigation: NativeStackNavigationProp<RootStackParamList, 'TrailDetail'>;
};
```

### State Management avec Zustand

- Cr√©er des stores s√©par√©s par domaine fonctionnel
- Typer les stores avec TypeScript
- Utiliser des s√©lecteurs pour optimiser les re-renders
- Persister les donn√©es importantes avec AsyncStorage

```typescript
// ‚úÖ BON
interface TrackingState {
  isTracking: boolean;
  currentSession: Session | null;
  startTracking: () => void;
  stopTracking: () => void;
}

export const useTrackingStore = create<TrackingState>((set) => ({
  isTracking: false,
  currentSession: null,
  startTracking: () => set({ isTracking: true }),
  stopTracking: () => set({ isTracking: false, currentSession: null }),
}));

// Utilisation avec s√©lecteur
const isTracking = useTrackingStore((state) => state.isTracking);
```

### Hooks Personnalis√©s

- Pr√©fixer TOUS les hooks avec `use`
- Placer les hooks dans `src/hooks/`
- Grouper les hooks li√©s dans des sous-dossiers
- Exporter depuis `src/hooks/index.ts`

```typescript
// ‚úÖ BON - hooks/useGeolocation.ts
export const useGeolocation = () => {
  const [location, setLocation] = useState<Location | null>(null);
  // ...
  return { location, error, requestPermission };
};

// hooks/index.ts
export { useGeolocation } from './useGeolocation';
export { useActivity } from './useActivity';
```

## Bonnes Pratiques Sp√©cifiques au Projet

### G√©olocalisation et Tracking

- Toujours demander les permissions avant d'acc√©der √† la localisation
- Utiliser `expo-location` pour le tracking
- G√©rer le tracking en arri√®re-plan avec `expo-task-manager`
- Optimiser la fr√©quence de mise √† jour GPS pour √©conomiser la batterie
- Stocker les sessions de tracking dans AsyncStorage

### Photos et M√©dias

- Utiliser `expo-image-picker` pour la s√©lection de photos
- Impl√©menter la s√©lection multiple de photos
- Optimiser les images avant upload (compression)
- G√©rer les permissions cam√©ra/galerie

### Composants de Tracking

- Utiliser les composants dans `src/components/tracking/`
- `TrackingHeader` pour l'en-t√™te
- `TrackingFooter` pour le footer de navigation
- `TrackingStats` pour afficher les statistiques
- `PhotosSection` pour g√©rer les photos

### Modales

- Utiliser les composants Modal React Native
- Centraliser les modales complexes dans `src/components/modals/`
- G√©rer l'√©tat d'ouverture/fermeture avec Zustand ou state local

### Navigation Footer

- Utiliser `FooterNavigation` pour une navigation coh√©rente
- D√©finir les routes dans le composant
- G√©rer l'√©tat actif/inactif visuellement

### Social & Posts

- Utiliser `CreatePostModal` pour cr√©er des posts
- `SocialFeed` pour afficher le feed
- `SocialPostCard` pour les cartes de post
- G√©rer les photos multiples dans les posts

## Performance

- Utiliser `React.memo` pour les composants qui re-render souvent
- Utiliser `useCallback` pour les fonctions pass√©es en props
- Utiliser `useMemo` pour les calculs co√ªteux
- Optimiser les listes avec `FlatList` et `keyExtractor`
- Lazy load des images avec optimisation

```typescript
// ‚úÖ BON
const TrailList = React.memo<TrailListProps>(({ trails, onTrailPress }) => {
  const renderItem = useCallback(
    ({ item }: { item: Trail }) => (
      <TrailCard trail={item} onPress={() => onTrailPress(item.id)} />
    ),
    [onTrailPress]
  );

  return (
    <FlatList
      data={trails}
      renderItem={renderItem}
      keyExtractor={(item) => item.id}
    />
  );
});
```

## Gestion des Erreurs

- Toujours encapsuler les appels API dans try/catch
- Afficher des messages d'erreur clairs √† l'utilisateur
- Logger les erreurs pour le debugging
- G√©rer les cas de permissions refus√©es

```typescript
// ‚úÖ BON
try {
  const response = await axios.get('/api/trails');
  setTrails(response.data);
} catch (error) {
  console.error('Erreur lors du chargement des sentiers:', error);
  Alert.alert('Erreur', 'Impossible de charger les sentiers');
}
```

## Nommage

- **Composants**: PascalCase (`TrailCard`, `SocialFeed`)
- **Fichiers de composants**: PascalCase (`TrailCard.tsx`)
- **Hooks**: camelCase avec pr√©fixe use (`useGeolocation`, `useActivity`)
- **Utilitaires**: camelCase (`formatDistance`, `calculateElevation`)
- **Types/Interfaces**: PascalCase (`Trail`, `User`, `TrackingSession`)
- **Constantes**: UPPER_SNAKE_CASE (`API_BASE_URL`, `MAX_PHOTOS`)
- **Variables**: camelCase (`currentLocation`, `isTracking`)

## API et Services

- Centraliser les appels API dans `src/services/`
- Utiliser Axios pour les requ√™tes HTTP
- D√©finir les endpoints dans des constantes
- G√©rer les tokens d'authentification avec SecureStore

## Testing (√† d√©velopper)

- √âcrire des tests unitaires pour les hooks et utils
- √âcrire des tests d'int√©gration pour les flows critiques
- Tester les composants avec React Native Testing Library

## Git et Commits

- Commits en fran√ßais
- Utiliser les pr√©fixes conventionnels:
  - `feat:` pour les nouvelles fonctionnalit√©s
  - `fix:` pour les corrections de bugs
  - `refactor:` pour le refactoring
  - `style:` pour les changements de style
  - `docs:` pour la documentation
  - `perf:` pour les optimisations de performance
  - `test:` pour les tests

## Remarques Importantes

- ‚ö†Ô∏è **TOUJOURS** tester sur un appareil r√©el pour la g√©olocalisation
- ‚ö†Ô∏è **TOUJOURS** g√©rer les permissions de mani√®re explicite
- ‚ö†Ô∏è **TOUJOURS** optimiser les images et m√©dias
- ‚ö†Ô∏è **TOUJOURS** tester la performance sur des appareils bas de gamme
- ‚ö†Ô∏è **TOUJOURS** g√©rer les √©tats de chargement et d'erreur
- ‚ö†Ô∏è **TOUJOURS** pr√©voir les cas offline (pas de connexion)

## √Ä Compl√©ter

<!-- Ajoutez ici vos r√®gles personnalis√©es sp√©cifiques au projet -->
